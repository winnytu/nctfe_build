(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-24034eb7"],{"18d5":function(e,t,s){e.exports=s.p+"img/user.e33d47fc.jpg"},"1de5":function(e,t,s){e.exports=s.p+"img/card1.ed6ce178.jpg"},"1f22":function(e,t,s){},3282:function(e,t,s){"use strict";s("8ec8")},"858f":function(e,t,s){"use strict";s("1f22")},"8ec8":function(e,t,s){},"9c5e":function(e,t,s){"use strict";var a=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"exchange-item-container"},[a("div",{staticClass:"exchange-item-row"},e._l(e.itemList,(function(t,n){return a("div",{key:n,staticClass:"exchange-item-wrapper",on:{click:function(s){return e.showDetail(t)}}},[a("el-badge",{staticClass:"item",attrs:{value:t.applyCount,max:99,hidden:t.applyCount<1}},[e.isApply?a("div",{staticClass:"exchange-item"},[a("div",{staticClass:"img-container"},[a("img",{attrs:{src:t.exchangeInfo.img?t.exchangeInfo.img:e.defaultimg}})]),"專卡"!==t.exchangeInfo.category?a("div",{staticClass:"category"},[e._v("\n\t\t\t\t\t"+e._s(t.exchangeInfo.category)+"\n\t\t\t\t")]):a("div",{staticClass:"group"},[a("span",{staticClass:"groupname"},[e._v(e._s(t.exchangeInfo.groupName))]),a("span",{staticClass:"album"},[e._v(e._s(t.exchangeInfo.album))])]),a("div",{staticClass:"exchange-detail"},[a("div",{staticClass:"own"},e._l(t.exchangeInfo.ownMember,(function(t){return a("div",{key:t,staticClass:"member"},[e._v(e._s(t)+" ")])})),0),a("div",{staticClass:"exchange-icon"},[e._v("換")]),a("div",{staticClass:"target"},e._l(t.exchangeInfo.targetMember,(function(t,s){return a("div",{key:s,staticClass:"member"},[e._v(e._s(t)+" ")])})),0)]),a("div",{staticClass:"note"},[a("p",e._l(t.exchangeInfo.note,(function(t){return a("span",{key:t},[e._v("#"+e._s(t)+" ")])})),0)]),a("div",{staticClass:"user"},[a("div",{staticClass:"user-info"},[a("div",{staticClass:"img"},[a("img",{attrs:{src:s("18d5"),alt:""}})]),a("div",{staticClass:"loginname"},[e._v(e._s(t.exchangeInfo.creator))])]),a("div",{staticClass:"date"},[e._v(e._s(t.exchangeInfo.update_at))])])]):a("div",{staticClass:"exchange-item"},[a("div",{staticClass:"img-container"},[a("img",{attrs:{src:t.img?t.img:e.defaultimg}})]),"專卡"!==t.category?a("div",{staticClass:"category"},[e._v("\n\t\t\t\t\t"+e._s(t.category)+"\n\t\t\t\t")]):a("div",{staticClass:"group"},[a("span",{staticClass:"groupname"},[e._v(e._s(t.groupName))]),a("span",{staticClass:"album"},[e._v(e._s(t.album))])]),a("div",{staticClass:"exchange-detail"},[a("div",{staticClass:"own"},e._l(t.ownMember,(function(t){return a("div",{key:t,staticClass:"member"},[e._v(e._s(t)+" ")])})),0),a("div",{staticClass:"exchange-icon"},[e._v("換")]),a("div",{staticClass:"target"},e._l(t.targetMember,(function(t,s){return a("div",{key:s,staticClass:"member"},[e._v(e._s(t)+" ")])})),0)]),a("div",{staticClass:"note"},[a("p",e._l(t.note,(function(t){return a("span",{key:t},[e._v("#"+e._s(t)+" ")])})),0)]),a("div",{staticClass:"user"},[a("div",{staticClass:"user-info"},[a("div",{staticClass:"img"},[a("img",{attrs:{src:s("18d5"),alt:""}})]),a("div",{staticClass:"loginname"},[e._v(e._s(t.creator))])]),a("div",{staticClass:"date"},[e._v(e._s(t.update_at))])])])])],1)})),0),a("exchangeDetail",{attrs:{showDialog:e.showExchangeDetail,exchangeItem:e.curExchangeItem},on:{"update:showDialog":function(t){e.showExchangeDetail=t},"update:show-dialog":function(t){e.showExchangeDetail=t},success:e.success}}),a("exchangeMessage",{attrs:{showDialog:e.showExchangeMessage,exchangeItem:e.curExchangeItem},on:{"update:showDialog":function(t){e.showExchangeMessage=t},"update:show-dialog":function(t){e.showExchangeMessage=t}}})],1)},n=[],i=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("el-dialog",{staticClass:"exchange-detail",attrs:{visible:e.showDialog,width:"800"},on:{close:function(t){return e.onClose()}}},[s("div",{staticClass:"title",attrs:{slot:"title"},slot:"title"},[e._v("\n    "+e._s(1==e.step?"交換物品詳情":"交換資訊確認")+"\n  ")]),1==e.step?s("div",{staticClass:"item-info"},[s("div",{staticClass:"img-container"},[s("img",{attrs:{src:e.exchangeItem.img?e.exchangeItem.img:e.defaultimg}})]),s("div",{staticClass:"category-group"},[s("p",{staticClass:"category"},[e._v(e._s(e.exchangeItem.category))]),"專卡"===e.exchangeItem.category?s("p",{staticClass:"album"},[e._v(e._s(e.exchangeItem.groupName)+" "+e._s(e.exchangeItem.album))]):e._e()]),s("p",{staticClass:"member"},[e._l(e.exchangeItem.ownMember,(function(t){return s("span",{key:t},[e._v(e._s(t)+" ")])})),e._v(" 換 "),e._l(e.exchangeItem.targetMember,(function(t,a){return s("span",{key:a},[e._v(e._s(t)+" ")])}))],2),s("p",{staticClass:"desc"},[e._v(e._s(e.exchangeItem.desc))]),s("p",{staticClass:"note"},e._l(e.exchangeItem.note,(function(t){return s("span",{key:t},[e._v("#"+e._s(t)+" ")])})),0),0==e.applyStatus?s("el-form",{staticClass:"apply-form"},[s("div",{staticClass:"apply-title"},[e._v("申請交換")]),s("el-form-item",{attrs:{label:"選擇擁有成員"}},[s("el-checkbox-group",{model:{value:e.form.ownMember,callback:function(t){e.$set(e.form,"ownMember",t)},expression:"form.ownMember"}},e._l(e.exchangeItem.targetMember,(function(e,t){return s("el-checkbox",{key:t,attrs:{label:e,name:"member"}})})),1)],1),s("el-form-item",{attrs:{label:"選擇欲交換成員"}},[s("el-checkbox-group",{attrs:{size:"small"},model:{value:e.form.targetMember,callback:function(t){e.$set(e.form,"targetMember",t)},expression:"form.targetMember"}},e._l(e.exchangeItem.ownMember,(function(e,t){return s("el-checkbox",{key:t,attrs:{label:e,name:"member"}})})),1)],1),s("el-form-item",{attrs:{label:"交換方式"}},[s("el-checkbox-group",{model:{value:e.form.exchangeWay,callback:function(t){e.$set(e.form,"exchangeWay",t)},expression:"form.exchangeWay"}},e._l(e.exchangeItem.exchangeWay,(function(e,t){return s("el-checkbox",{key:t,attrs:{label:e,name:"way"}})})),1)],1)],1):s("el-alert",{attrs:{title:"您已提交申請",type:"warning",closable:!1}})],1):e._e(),2==e.step?s("div",{staticClass:"check-form"},[s("p",[s("span",{staticClass:"form-title"},[e._v("交換物品")]),s("span",{staticClass:"category"},[e._v(e._s(e.exchangeItem.category))]),"專卡"===e.exchangeItem.category?s("span",{staticClass:"album"},[e._v(e._s(e.exchangeItem.groupName)+" "+e._s(e.exchangeItem.album))]):e._e()]),s("p",[s("span",{staticClass:"form-title"},[e._v("擁有成員")]),e._l(e.form.ownMember,(function(t){return s("span",{key:t,staticClass:"member"},[e._v(e._s(t))])}))],2),s("p",[s("span",{staticClass:"form-title"},[e._v("欲交換成員")]),e._l(e.form.targetMember,(function(t){return s("span",{key:t},[e._v(e._s(t))])}))],2),s("p",[s("span",{staticClass:"form-title"},[e._v("可交易方式")]),e._l(e.exchangeItem.exchangeWay,(function(t){return s("span",{key:t},[e._v(e._s(t))])}))],2),s("p",{staticClass:"form-title"},[e._v("填寫交換訊息")]),s("el-input",{attrs:{type:"textarea",placeholder:"請填入訊息"},model:{value:e.message.postMessage,callback:function(t){e.$set(e.message,"postMessage",t)},expression:"message.postMessage"}}),s("div",{staticClass:"warning-text"},[s("i",{staticClass:"el-icon-warning"}),e._v("點擊送出即提交申請，若隨意取消交易可能會影響您的評價")])],1):e._e(),s("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(t){return e.onClose()}}},[e._v(e._s(1==e.applyStatus?"關閉":1==e.step?"取消":"上一步"))]),0==e.applyStatus?s("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.onSubmit()}}},[e._v(e._s(1==e.step?"下一步":"確認送出"))]):e._e()],1)])},c=[],r=(s("8e6e"),s("ac6a"),s("456d"),s("bd86")),o=s("2f62"),l=s("b4b8");function m(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,a)}return s}function u(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?m(Object(s),!0).forEach((function(t){Object(r["a"])(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):m(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}var g={props:{showDialog:{type:Boolean,require:!0},exchangeItem:{require:!0}},data:function(){return{applyStatus:0,defaultimg:s("1de5"),step:1,form:{targetMember:[],ownMember:[],exchangeWay:[]},message:{postMessage:""}}},computed:u({},Object(o["c"])({userImg:function(e){return e.user.userImg},userName:function(e){return e.user.userName}})),watch:{showDialog:function(e){e&&(this.form={targetMember:[],ownMember:[],exchangeWay:[]},this.message={postMessage:""},this.checkStatus())}},mouted:function(){},methods:{checkStatus:function(){var e=this;Object(l["b"])({userName:this.$store.state.user.userName,itemId:this.exchangeItem.itemId}).then((function(t){e.applyStatus=t.applyStatus}))},onClose:function(){2!=this.step?this.$emit("update:showDialog",!1):this.step=1},onSubmit:function(){this.submitItem()},submitItem:function(){var e=this;if(1==this.step)return this.message.postMessage="您好，我有".concat(this.form.ownMember,"想跟您換").concat(this.form.targetMember),void(this.step=2);var t=this.form;t.itemId=this.exchangeItem.itemId,t.exchangeItemId=this.exchangeItem.exchangeItemId,t.applier=this.userName,this.message.fromUser=this.userName,this.message.toUser=this.exchangeItem.creator,this.message.relatedItem=this.exchangeItem.itemId,t.message=this.message,Object(l["a"])(t).then((function(t){console.log(t.data),e.$emit("success")})).catch((function(e){console.log(e)})),this.$emit("update:showDialog",!1)}}},p=g,h=(s("cda1"),s("2877")),f=Object(h["a"])(p,i,c,!1,null,"00e456e8",null),d=f.exports,v=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("el-dialog",{staticClass:"message-center",attrs:{visible:e.showDialog,width:"1100"},on:{close:function(t){return e.onClose()}}},[s("div",{staticClass:"msg-container"},[e.applyList&&e.applyList.length>0?s("div",{staticClass:"msg-list"},[s("div",{staticClass:"title"},[e._v("\n            申請列表\n        ")]),e._v("\n        \b"),e._l(e.applyList,(function(t,a){return s("div",{key:a,staticClass:"msg-list-item"},[s("div",{staticClass:"msg",class:{active:e.curItem.applier==t.applier},on:{click:function(s){return e.selectItem(t)}}},[s("p",{staticClass:"applier"},[e._v(e._s(t.applier))]),s("div",{staticClass:"member"},[e._l(t.ownMember,(function(t){return s("span",{key:t,staticClass:"member"},[e._v(e._s(t))])})),e._v("\n                    換\n                    "),e._l(t.targetMember,(function(t,a){return s("span",{key:a,staticClass:"member"},[e._v(e._s(t)+" ")])}))],2),s("p",{staticClass:"date"},[e._v(e._s(t.create_time))])])])}))],2):s("div",{staticClass:"nodata"},[s("p",[e._v("無申請資料")])]),e.applyList&&e.applyList.length>0?s("div",{staticClass:"msg-box"},[s("div",{staticClass:"title"},[e.curMessageList.length>0?s("p",[e._v(e._s(e.curMessageList[0].fromUser==e.userName?e.curMessageList[0].toUser:e.curMessageList[0].fromUser))]):e._e()]),s("div",{staticClass:"msg-detail-container"},e._l(e.curMessageList,(function(t,a){return s("div",{key:a,staticClass:"msg-detail",class:{self:t.fromUser==e.userName}},[s("div",{staticClass:"text"},[e._v(e._s(t.postMessage))]),s("div",{staticClass:"date"},[e._v(e._s(t.create_time))])])})),0),s("div",{staticClass:"msg-send"},[s("el-input",{staticClass:"type-box",attrs:{autosize:"",maxlength:"100",type:"textarea","show-word-limit":"",placeholder:"輸入訊息"},model:{value:e.msgText,callback:function(t){e.msgText=t},expression:"msgText"}}),s("el-button",{staticClass:"btn-send",on:{click:function(t){return e.doSendMessage()}}},[e._v("送出")])],1)]):e._e(),s("div",{staticClass:"msg-info"},[s("div",{staticClass:"title"},[e._v("\n            物品資訊\n        ")]),s("div",{staticClass:"info-container"},[s("div",{staticClass:"img-container"},[s("img",{attrs:{src:e.exchangeItem.img?e.exchangeItem.img:e.defaultimg}})]),s("div",{staticClass:"category-group"},[s("p",{staticClass:"category"},[e._v(e._s(e.exchangeItem.category))]),"專卡"===e.exchangeItem.category?s("p",{staticClass:"album"},[e._v(e._s(e.exchangeItem.groupName)+" "+e._s(e.exchangeItem.album))]):e._e()]),s("p",{staticClass:"member"},[e._l(e.exchangeItem.ownMember,(function(t){return s("span",{key:t},[e._v(e._s(t)+" ")])})),e._v(" 換 "),e._l(e.exchangeItem.targetMember,(function(t,a){return s("span",{key:a},[e._v(e._s(t)+" ")])}))],2),s("p",{staticClass:"desc"},[e._v(e._s(e.exchangeItem.desc))]),s("p",{staticClass:"note"},e._l(e.exchangeItem.note,(function(t){return s("span",{key:t},[e._v("#"+e._s(t)+" ")])})),0)])])])])},_=[],b=(s("96cf"),s("3b8d")),x=s("c443");function y(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,a)}return s}function C(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?y(Object(s),!0).forEach((function(t){Object(r["a"])(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):y(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}var I={props:{showDialog:{type:Boolean,require:!0},exchangeItem:{}},data:function(){return{applyList:[],myExchangeList:[],defaultimg:s("1de5"),curItemId:"",curItem:{},msgText:"",curMessageType:"my",curMessageList:[],curMessageTypeList:[]}},computed:C({},Object(o["c"])({userImg:function(e){return e.user.userImg},userName:function(e){return e.user.userName}})),watch:{showDialog:function(e){e&&this.getApplyListFunc()}},mounted:function(){var e=Object(b["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));function t(){return e.apply(this,arguments)}return t}(),methods:{getApplyListFunc:function(){var e=this;Object(l["d"])({itemId:this.exchangeItem.itemId}).then((function(t){console.log(t),e.applyList=t.messageList,e.selectItem(e.applyList[0])})).catch((function(e){console.log(e)}))},selectItem:function(e){this.curItemId=e.itemId,this.curItem=e,this.getItemMessage()},getItemMessage:function(){var e=this,t={itemId:this.curItemId,applier:this.curItem.applier,creator:this.exchangeItem.creator};Object(x["a"])(t).then((function(t){console.log(t),e.curMessageList=t.messageList})).catch((function(e){console.log(e)}))},doSendMessage:function(){var e=this,t=this.curMessageList[0],s={postMessage:this.msgText,fromUser:this.userName,toUser:t.fromUser!==this.userName?t.fromUser:t.toUser,relatedItem:t.relatedItem};console.log(s),Object(x["b"])(s).then((function(t){e.getItemMessage(),e.msgText=""})).catch((function(e){console.log(e)}))},onClose:function(){this.$emit("update:showDialog",!1)}}},w=I,M=(s("858f"),Object(h["a"])(w,v,_,!1,null,"4cefb395",null)),O=M.exports,k={name:"exchangeItem",components:{exchangeDetail:d,exchangeMessage:O},props:{itemList:{type:Array,default:[]},isApply:{type:Boolean,default:!1},isList:{type:Boolean,default:!0}},data:function(){return{defaultimg:s("1de5"),curExchangeItem:"",showExchangeDetail:!1,showExchangeMessage:!1}},methods:{showDetail:function(e){this.isApply?this.curExchangeItem=e.exchangeInfo:this.curExchangeItem=e,this.isList?this.showExchangeDetail=!0:(console.log(14),this.showExchangeMessage=!0)},success:function(){this.$emit("success")}}},j=k,D=(s("3282"),Object(h["a"])(j,a,n,!1,null,"6c9410c0",null));t["a"]=D.exports},c443:function(e,t,s){"use strict";s.d(t,"b",(function(){return n})),s.d(t,"a",(function(){return i}));var a=s("a13e");function n(e){return Object(a["a"])({url:"/message/send",method:"post",data:e})}function i(e){return Object(a["a"])({url:"/exchange/messageList",method:"post",data:e})}},cda1:function(e,t,s){"use strict";s("f969")},f969:function(e,t,s){}}]);
//# sourceMappingURL=chunk-24034eb7.378692fe.js.map